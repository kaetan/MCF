## Схемы
- [Event Storming](ES.png)
- [Модель данных](DataModel.png)
- [Модель коммуникаций](CommunicationModel.png)

## Определение контекстов
Выявил пять контекстов.
#### **1. Найм исполнителей.**
События, команды и данные в этом контексте почти не связаны со всем остальным функционалом системы. Единственная информация, которой контекст найма делится с остальными контекстами - это Исполнители (воркеры).
#### **2. Заказы.** 
В этом контексте собрал услуги, основной жизненный цикл заказа, ставки менеджеров на заказ и ревью неудачных заказов. Изначально была идея вынести ставки и ревью в самостоятельные контексты, но после составления модели данных увидел, что эти контексты владели бы крайне малым количеством данных и очень много данных читали бы. Решил объединить их с основным циклом Заказа.
#### **3. Подбор исполнителя.**
Содержит алгоритм подбора исполнителя к Заказу. Очень небольшой самостоятельный контекст, который в обычных условиях я бы оставил в контексте "Заказы", но два условия заставляют вынести отдельно: частые изменения внутрянки алгоритма и нежелание команды разработки алгоритма использовать общий словарь терминов.
#### **4. Расходники.** 
Управление складом расходников не вижу смысла смешивать с другими контекстами, так как будет проще дорабатывать и изменять складские процессы. Контекст взаимодействует с контекстом "Заказы" и внешними вендорами.
#### **5. Аккаунтинг.** 
Отвечает за выплаты и выставления счетов по завершении календарных циклов. Так же реализует механизм расчета индивидуальной скидки Клиента, так как скидка зависит от затраченной суммы и пересчитывается после каждого оплаченного счета. Вынес в самостоятельный контекст, так как оплаты и выплаты не привязаны к жизненному циклу Заказа.

## Реализация системы
Систему предлагаю реализовать в виде пяти независимых сервисов, каждый из которых соответствует одному из перечисленных выше контекстов.

#### **1. Сервис найма Исполнителей.** 
Отвечает за обработку Заявок на тест Исполнителя. Функционал вынесен в полностью самостоятельный сервис, так как на него ожидается самая большая нагрузка и существует опасность DDoS-атак. Нельзя допустить влияния этих факторов на другие части системы. Также сервис найма не имеет сильной привязки к логике остальных сервисов.
- Асинхронно отправляет CUD Исполнителя в остальные сервисы.

#### **2. Сервис Заказов.** 
Отвечает за создание Заказа, расчет его стоимости, ставки менеджеров на итоги Заказа, смену статусов Заказа, ревью отмененных и проваленных Заказов. Основной жизненный цикл заказа, система ставок и ревью - не часто изменяемые части системы, и завязаны на сущности Заказа. Их можно объединить в общий сервис.
- Асинхронно отправляет CUD Заказа в остальные сервисы.
- Синхронно обращается в Сервис подбора Исполнителей за получением Исполнителя.
- Синхронно обращается в Сервис склада Расходников за созданием заявки на получение Расходников.

#### **3. Сервис подбора Исполнителей.** 
Реализует алгоритм подбора Исполнителя для конкретного Заказа. Вынесен в самостоятельный сервис, так как планируется быть самой изменчивой частью Системы. Также разработчики алгоритма ни в какую не желают изменить используемые ими именования сущностей и не раскрывают деталей алгоритма. Всем будет лучше, если этот функционал будет обособлен. Но основная причина, все же, это изменчивость и необходимость часто проверять новые гипотезы по подбору Исполнителя.
- Синхронно выдает Сервису Заказов подходящего к Заказу исполнителя.

#### **4. Сервис склада Расходников.** 
Отвечает за обработку Запросов по сбору расходников для Заказа. Вынесен в отдельный сервис, так как содержит работающий с задержкой функционал - заказ fur-tune-печеньки индивидуально для каждого комплекта Расходников. Здесь требуется асинхронная коммуникация.
- Асинхронно сообщает остальным сервисам Заказов об успешном укомплектовании Заказа расходниками.

#### **5. Сервис Аккаунтинга.** 
Отвечает за еженедельные выставления счетов Клиентам и ежемесячные выплаты Исполнителям. Так же реализует механизм расчета индивидуальной скидки Клиента, так как скидка зависит от затраченной суммы и пересчитывается после каждого выставления счета.
- Асинхронно сообщает остальным сервисам о перерасчете индивидуальной скидки Клиента (оплаты раз в неделю, можно не рассылать размер скидки синхронно).
